#!/usr/bin/env bash
# Script to set up Nginx with custom HTTP header X-Served-By
# Ignore SC2154 for ShellCheck as per project instruction

# Install Nginx
apt-get update -y
apt-get install -y nginx

# Ensure Nginx is running
systemctl enable nginx
systemctl start nginx

# Get the hostname of the machine
HOSTNAME=$(hostname)

# Add the custom header to Nginx default config
CONFIG_FILE="/etc/nginx/sites-available/default"

# Add header if not already present
if ! grep -q "add_header X-Served-By" "$CONFIG_FILE"; then
    sed -i "/^\s*location \/ {/a \        add_header X-Served-By \"$HOSTNAME\";" "$CONFIG_FILE"
fi

# Reload Nginx to apply changes
nginx -t && systemctl reload nginx

