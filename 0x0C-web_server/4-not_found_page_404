#!/usr/bin/env bash
# Installs Nginx and sets a custom 404 page with message: Ceci n'est pas une page

set -e

# Install nginx if not already installed
if ! command -v nginx >/dev/null 2>&1; then
  apt-get update -y
  apt-get install nginx -y
fi

# Custom 404 HTML content
echo "Ceci n'est pas une page" > /var/www/html/custom_404.html

# Path to default Nginx site config
CONFIG_FILE="/etc/nginx/sites-available/default"

# Add custom error_page directive if not present
if ! grep -q "error_page 404" "$CONFIG_FILE"; then
  sed -i "/server_name _;/a \\\n    error_page 404 /custom_404.html;\n    location = /custom_404.html {\n        root /var/www/html;\n        internal;\n    }" "$CONFIG_FILE"
fi

# Restart nginx
service nginx restart
